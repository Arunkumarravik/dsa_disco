<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Problem Editor</title>
  <link rel="stylesheet" href="dsa_styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/python/python.min.js"></script>
  <script src="dsa_problem_ed_js.js" defer></script>

</head>
<body>
  <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <button class="menu-toggle" onclick="toggleSidebar()">☰</button>
        </div>
        <nav>
            <ul class="sidebar-menu">
                <li class="menu-item active"><a href="dsa_home.html">Home</a></li>
                <li class="menu-item"><a href="dsa_solve_problem.html">Solve Problem</a></li>
                <li class="menu-item"><a href="solved_problems.html">Solved Problems</a></li>
                <li class="menu-item"><a href="problem_list.html">Problems List</a></li>
            </ul>
        </nav>
    </aside>


  <main class="main-content">
    <h1 id="problem-title"></h1>
    <div id="problem-desc" style="border:1px solid #ccc; padding:10px;"></div>
    <h3 style="color: black;"> >- Code here --- 🐱‍👤</h3>
    <div id="code-editor" style=" border:1px solid #ccc; margin-top:20px;"></div>
     <div class="code-buttons" style="margin-top:10px;">
    <button id="run-code-btn">Run Code</button>
    <button id="submit-code-btn">Submit Code</button>
  </div>

  <!-- Tabs -->
  <div class="code-tabs" style="margin-top:15px;">
    <button class="tab-btn active" data-tab="sample-test">Sample Test Case</button>
    <button class="tab-btn" data-tab="test-result">Test Result</button>
  </div>

  <div class="tab-content" style="border:1px solid #ccc; padding:10px; margin-top:5px;">
    <div id="sample-test" class="tab-panel active">Sample Test Case Output...</div>
    <div id="test-result" class="tab-panel">Test Result Output...</div>
  </div>
</main></main>

  <script>
   //Toggling the side bar 
  const sampleBtn = document.querySelector('[data-tab="sample-test"]');
  const resultBtn = document.querySelector('[data-tab="test-result"]');
  const samplePanel = document.getElementById("sample-test");
  const resultPanel = document.getElementById("test-result");

  sampleBtn.addEventListener("click", () => {
    sampleBtn.classList.add("active");
    samplePanel.classList.add("active");

    resultBtn.classList.remove("active");
    resultPanel.classList.remove("active");
  });

  
  resultBtn.addEventListener("click", () => {
    resultBtn.classList.add("active");
    resultPanel.classList.add("active");

    sampleBtn.classList.remove("active");
    samplePanel.classList.remove("active");
  });
 // Parse URL params
     params = new URLSearchParams(window.location.search);
    const title = params.get("title");
    const topic = params.get("topic");
    //const title="array_frequency_count";
    //const topic="array";
    document.getElementById("problem-title").innerText = `${title} (${topic})`;

    async function get_problem_data(){

        const today=new Date()
        const today_date=today.toLocaleDateString()
        const problem_title="array_frequency_count"
        params = new URLSearchParams(window.location.search);
        const title = params.get("title");

        // Call backend API
        get_payload={
            "user_id"  : 1 ,
            "problem_name" :  title
        }

        payload={
            "event" :  "get",
            "type" :  "problem",
            "data" :  get_payload
        }

        // Fetch problem description
        const response=  await fetch('https://dsadiscobackend-214580149659.us-west1.run.app', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        const data= await response.json()

        return data

    }

    (async () => {
    const json_data = await get_problem_data();

    console.log(json_data)

    // Assuming backend includes title in response
    document.getElementById("problem-title").innerText = title || "No title";
    document.getElementById("problem-desc").innerHTML = json_data[0].latest_problem_description || "No description";
    //adjustDescriptionHeight()
})();

    // Setup editor
   document.addEventListener("DOMContentLoaded", () => {
  const editorContainer = document.getElementById("code-editor");

  window.codeEditor = CodeMirror(editorContainer, {
    value: "# Write your code here\ndef solve():\n    pass\n",
    mode: "python",
    lineNumbers: true,
    theme: "eclipse",
    readOnly: false
  });

  // Make sure it can grab focus
  editorContainer.querySelector(".CodeMirror").tabIndex = 0;

  setTimeout(() => window.codeEditor.refresh(), 200);
});

  </script>
</body>
</html>
